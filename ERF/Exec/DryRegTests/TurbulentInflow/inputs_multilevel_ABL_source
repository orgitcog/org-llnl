# ------------------  INPUTS TO MAIN PROGRAM  -------------------
#max_step = 3000000
stop_time = 7200.0

amrex.fpe_trap_invalid = 0

fabarray.mfiter_tile_size = 1024 1024 1024

# PROBLEM SIZE & GEOMETRY (dx=dy=dz=18m)
geometry.prob_lo =    0     0    0
geometry.prob_hi = 2700  2700  990
amr.n_cell        = 150  150    55

geometry.is_periodic = 1 0 0

ylo.type = "Inflow"
yhi.type = "Outflow"
ylo.dirichlet_file = "inflow.txt"
    
zlo.type = "NoSlipWall"
zhi.type = "SlipWall"
zhi.theta_grad = 0.004

erf.sponge_type = "input_sponge"
erf.input_sponge_file = "sponge.txt"
erf.sponge_strength = 1.0
erf.use_yhi_sponge_damping = true
erf.yhi_sponge_start = 2500.0

# TIME STEP CONTROL
erf.fixed_dt = -1
erf.cfl = 0.4

# DIAGNOSTICS & VERBOSITY
erf.sum_interval   = 1        # timesteps between computing mass
erf.v              = 1        # verbosity in ERF.cpp
amr.v              = 1        # verbosity in Amr.cpp

# REFINEMENT / REGRIDDING
#amr.max_level       = 0       # maximum level number allowed
amr.max_level = 1
amr.ref_ratio = 3
erf.refinement_indicators = box1
erf.box1.max_level = 1
erf.box1.in_box_lo =  450.   900.  0.
erf.box1.in_box_hi = 2250.  1800. 180.
erf.coupling_type = "TwoWay"

# CHECKPOINT FILES
erf.check_file      = chk     # root name of checkpoint file
erf.check_int       = -1    # number of timesteps between checkpoints

# PLOTFILES
erf.plot_file_1     = plt     # prefix of plotfile name
erf.plot_int_1      = 100     # number of timesteps between plotfiles
erf.plot_vars_1     = z_phys density x_velocity y_velocity z_velocity pressure theta pert_pres pert_dens

# SOLVER CHOICE
erf.use_mono_adv       = true
erf.dycore_horiz_adv_type  = "Upwind_3rd"
erf.dycore_vert_adv_type   = "Upwind_3rd"
erf.dryscal_horiz_adv_type = WENO3
erf.dryscal_vert_adv_type  = WENO3
erf.use_gravity = true
erf.use_coriolis = false

# Turbulence closure
erf.molec_diff_type = "None"
erf.les_type  = "Deardorff"
erf.Ck        = 0.1  # Coefficient in Moeng1984, Eqn. 19
erf.Ce        = 0.7  # Note: Ce_lcoeff = C_e - 1.9*C_k
erf.Ce_wall   = 3.9  # To account for "wall effects"
erf.sigma_k   = 0.5  # TKE diffusion coeff = 2*Km = Km * inv_sigma_k, Moeng1984, Eqn. 15
erf.theta_ref = 300.0 # don't specify for variable theta when diagnosing stability

erf.rayleigh_damp_U = true
erf.rayleigh_damp_V = true
erf.rayleigh_damp_W = true
erf.rayleigh_damp_T = true
erf.rayleigh_zdamp = 150.0
erf.rayleigh_dampcoef = 0.2

erf.init_type = "input_sounding"
erf.sounding_type = Ideal
erf.input_sounding_file = "sounding.txt"

## Turbulent inflow generation
erf.fix_random_seed  = 1
erf.perturbation_type = "source"  
erf.perturbation_direction = 0 1 0 0 0 0
erf.perturbation_layers = 2  
erf.perturbation_offset = 0 # number of grid cells from boundary
erf.perturbation_box_dims = 10 10 5 # H_PB = 1/8*Lz, Lz = PBLH = 750m. 750/8/18=5
erf.perturbation_nondimensional = 0.042 # 0.01818324 to match Ec # from WRF
erf.perturbation_T_infinity = 290.0

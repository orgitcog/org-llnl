description:
    name: hello_bye_world_flux_3
    description: Test variant of hello_bye_parameterized that exercises new exclusive flag behaviors

batch:
    type        : flux
    host        : rzadams
    bank        : guests
    queue       : pdebug
    allocation_args:
      setopt:                   # > 1 letter gets '--' prefix: --setopt foo=true
        foo: bar
      o:                        # single letter = '-' prefix; o == setopt for flux: -o bar=42
        bar: 42
      setattr:
        gpumode: CPX
      conf:
        resource:
          rediscover: "true" # Flux wants 'true', not 'True' that python bool serializes to
        
    launcher_args:
      setopt:
        fastload:
      exclusive: # Flag, so no value needed


        
env:
    variables:
        OUTPUT_PATH: hello_bye_world
    labels:
        OUT_FORMAT: $(GREETING)_$(NAME).txt

study:
    - name: hello_world
      description: Say hello to someone!
      run:
          cmd: |
            $(LAUNCHER) echo "$(GREETING), $(NAME)!" > $(OUT_FORMAT)
            $(LAUNCHER) sleep 1
          procs: 1
          nested: True
          exclusive: True       # Testing mixed batch/step
          walltime: "00:60"
          
    - name: bye_world
      description: Say bye to someone!
      run:
          cmd: |
            $(LAUNCHER) echo "Bye, World!" > bye.txt
            $(LAUNCHER) sleep 1
          procs: 1
          nested: True
          exclusive:         # Test overriding launcher from batch block
            allocation: True
            launcher: False     
          walltime: "00:60"
          depends: [hello_world]

global.parameters:
    # NAME:
    #     values: [Pam, Jim, Michael, Dwight]
    #     label: NAME.%%
    # GREETING:
    #     values: [Hello, Ciao, Hey, Hi]
    #     label: GREETING.%%
    NAME:
        values: [Pam]
        label: NAME.%%
    GREETING:
        values: [Hello]
        label: GREETING.%%

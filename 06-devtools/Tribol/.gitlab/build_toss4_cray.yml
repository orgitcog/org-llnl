##############################################################################
# Copyright (c) 2017-2025, Lawrence Livermore National Security, LLC and
# other Tribol Project Developers. See the top-level COPYRIGHT file for details.
#
# SPDX-License-Identifier: (MIT)
##############################################################################

####
# This is the shared configuration of jobs for toss4_cray
.on_toss4_cray:
  variables:
    SCHEDULER_PARAMETERS: "--queue pci --exclusive --time-limit=${ALLOC_TIME}m --nodes=${ALLOC_NODES}"
    COMPILER: "llvm-amdgpu@6.4.2"
    HOST_CONFIG: "tuolumne-toss_4_x86_64_ib_cray-${COMPILER}_hip.cmake"
  tags:
    - batch
    - tuolumne
  rules:
    - if: '$CI_COMMIT_BRANCH =~ /_qnone/ || $ON_TOSS4_CRAY == "OFF"' #run except if ...
      when: never
    - when: on_success
  before_script:
    - module load cmake/3.23.1

####
# Templates
.src_build_on_toss4_cray:
  extends: [.src_build_script, .on_toss4_cray]

####
# Build jobs
toss4_cray-llvm_amdgpu_6_4_2-src:
  variables:
    ALLOC_NODES: "1"
    ALLOC_TIME: "30"
  extends: .src_build_on_toss4_cray

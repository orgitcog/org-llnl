##############################################################################
# Copyright (c) 2017-2025, Lawrence Livermore National Security, LLC and
# other Tribol Project Developers. See the top-level COPYRIGHT file for details.
#
# SPDX-License-Identifier: (MIT)
##############################################################################

####
# This is the shared configuration of jobs for toss4
.on_toss4:
  variables:
    SCHEDULER_PARAMETERS: "--reservation=ci --exclusive=user --deadline=now+${ALLOC_DEADLINE}minutes -N ${ALLOC_NODES} -t ${ALLOC_TIME}"
    ALLOC_DEADLINE: "180" # Allocation times must be less than this value
  tags:
    - batch
    - dane
  rules:
    - if: '$CI_COMMIT_BRANCH =~ /_qnone/ || $ON_TOSS4 == "OFF"' #run except if ...
      when: never
    - when: on_success
  before_script:
    - module load cmake/3.23.1


####
# Templates
.src_build_on_toss4:
  extends: [.src_build_script, .on_toss4]

####
# Build jobs

toss4-llvm_19_1_3-src:
  variables:
    COMPILER: "llvm@19.1.3"
    HOST_CONFIG: "dane-toss_4_x86_64_ib-${COMPILER}.cmake"
    ALLOC_NODES: "1"
    ALLOC_TIME: "30"
  extends: .src_build_on_toss4

toss4-llvm_19_1_3-src-codevelop:
  variables:
    COMPILER: "llvm@19.1.3"
    HOST_CONFIG: "dane-toss_4_x86_64_ib-${COMPILER}.cmake"
    EXTRA_CMAKE_OPTIONS: "-DCMAKE_BUILD_TYPE=Release"
    ALLOC_NODES: "1"
    ALLOC_TIME: "30"
  extends: .src_build_on_toss4

toss4-gcc_13_3_1-src:
  variables:
    COMPILER: "gcc@13.3.1"
    HOST_CONFIG: "dane-toss_4_x86_64_ib-${COMPILER}.cmake"
    ALLOC_NODES: "1"
    ALLOC_TIME: "20"
  extends: .src_build_on_toss4

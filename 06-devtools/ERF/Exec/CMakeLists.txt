set(erf_lib_name erf_srclib)
add_library(${erf_lib_name} OBJECT)
if (BUILD_SHARED_LIBS)
  set_target_properties(${erf_lib_name} PROPERTIES POSITION_INDEPENDENT_CODE ON)
endif()
include(${CMAKE_SOURCE_DIR}/CMake/BuildERFExe.cmake)
build_erf_lib(${erf_lib_name})
if(NOT ERF_BUILD_LIBRARY_ONLY)
if (ERF_ENABLE_REGRESSION_TESTS_ONLY)
  add_subdirectory(DryRegTests/Couette_Poiseuille)
  add_subdirectory(DryRegTests/DensityCurrent)
  add_subdirectory(DryRegTests/EkmanSpiral)
  add_subdirectory(DryRegTests/IsentropicVortex)
  add_subdirectory(DryRegTests/ScalarAdvDiff)
  add_subdirectory(DryRegTests/TaylorGreenVortex)
  add_subdirectory(DryRegTests/TurbulentInflow)
  add_subdirectory(DevTests/FlowInABox)
  add_subdirectory(DevTests/LandSurfaceModel)
  add_subdirectory(DevTests/MovingTerrain)
  add_subdirectory(DevTests/Radiation)
  add_subdirectory(DevTests/TemperatureSource)
  add_subdirectory(DevTests/TropicalCyclone)
else ()
  add_subdirectory(ABL)
  add_subdirectory(MoistRegTests/Bomex)
  add_subdirectory(MoistRegTests/Bubble)
  add_subdirectory(MoistRegTests/SquallLine_2D)
  add_subdirectory(MoistRegTests/SuperCell_3D)
  add_subdirectory(MoistRegTests/WPS_and_Metgrid_Tests)
  add_subdirectory(DryRegTests/Couette_Poiseuille)
  add_subdirectory(DryRegTests/DensityCurrent)
  add_subdirectory(DryRegTests/EkmanSpiral)
  add_subdirectory(DryRegTests/IsentropicVortex)
  add_subdirectory(DryRegTests/ParticleAdvection)
  add_subdirectory(DryRegTests/ParticlesOverWoA)
  add_subdirectory(DryRegTests/ScalarAdvDiff)
  add_subdirectory(DryRegTests/TaylorGreenVortex)
  add_subdirectory(DryRegTests/Terrain3d_Hemisphere)
  add_subdirectory(DryRegTests/TurbulentInflow)
  add_subdirectory(DryRegTests/WitchOfAgnesi)
  add_subdirectory(DevTests/EB_SquareCylinder)
  add_subdirectory(DevTests/FlowInABox)
  add_subdirectory(DevTests/LandSurfaceModel)
  add_subdirectory(DevTests/MovingTerrain)
  add_subdirectory(DevTests/Radiation)
  add_subdirectory(DevTests/Shoc)
  add_subdirectory(DevTests/TemperatureSource)
  add_subdirectory(DevTests/TropicalCyclone)
  add_subdirectory(DevTests/Tornado)
endif()

if(ERF_ENABLE_TOOLS)
  message(STATUS "Building additional ERF tools")
  add_subdirectory(Tools)
endif()

endif() # NOT ERF_BUILD_LIBRARY_ONLY

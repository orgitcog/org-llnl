..
    Copyright 2023 Lawrence Livermore National Security, LLC and other
    Benchpark Project Developers. See the top-level COPYRIGHT file for details.

    SPDX-License-Identifier: Apache-2.0

#####################
 Compare Build Specs
#####################

``lib/scripts/diffBuildSpecs.py``

Compare two experiment build specs (dependence graphs with versions of dependencies),
generated by Spack for specified packages+options. This script enables the user to
compare packages and versions of two spack builds. Given two yaml package specs (use
``spack spec --yaml``), the script outputs which components of the packages are
different.

.. note::

    If you are trying to compare benchpark benchmarks, try using
    ``diffExperimentBuilds.py``.

********************************
 Example: dray with/without MPI
********************************

In this example, we see the difference of ``dray`` built with and without ``mpi``. The
difference between the specs ``dray+mpi`` and ``dray~mpi`` is indicated in the output by
``-> [openmpi]`` and the console output highlights the package differences in red.

.. code-block:: console

    $ spack spec --yaml dray+mpi > dray-mpi.yaml
    $ spack spec --yaml dray~mpi > dray-nompi.yaml
    $ spack-python lib/scripts/diffBuildSpecs.py ./dray-mpi.yaml ./dray-nompi.yaml

.. figure:: /_static/images/dray-diffspecs.png
    :align: center

    (Image output is truncated)

.. note::

    ``spack-python`` is required to import the spack libraries needed for this script.
    It will automatically be added to your ``$PATH`` when you run ``benchpark setup
    ...``.

*****************************
 Example: Installed packages
*****************************

If you want to compare already installed packages, provide the hashes

.. code-block:: console

    $ spack find -L quicksilver

    -- linux-rhel8-sapphirerapids / gcc@12.1.1 ----------------------
    fubnce7wzgjxhkim2cylijt4cbpfhxi6 quicksilver@master

    -- linux-rhel8-sapphirerapids / intel@2021.6.0-classic ----------
    qwev4yodp2joikf2oxvlo224ksjcqve3 quicksilver@master
    ==> 2 installed packages

    $ spack-python lib/scripts/diffBuildSpecs.py quicksilver/fubnce7wzgjxhkim2cylijt4cbpfhxi6 quicksilver/qwev4yodp2joikf2oxvlo224ksjcqve3

.. figure:: /_static/images/quicksilver-diffspecs.png
    :align: center

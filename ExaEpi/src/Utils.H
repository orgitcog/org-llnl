/*! @file Utils.H
    \brief Defines the #ExaEpi::Utils namespace
*/

#ifndef UTILS_H_
#define UTILS_H_

#include <AMReX_Geometry.H>
#include <AMReX_IntVect.H>
#include <vector>

#include "DemographicData.H"

#include <string>

namespace ExaEpi {

/*! \brief Structure with various simulation parameters; these are read in
    for the input file provided in the command line.
*/
struct TestParams {
    amrex::IntVect size;                                  /*!< domain size; (used only for ic_type = demo)
                                                               (see ExaEpi::Utils::getGeometry) */
    int max_box_size;                                     /*!< box size */
    int nsteps = 1;                                       /*!< number of simulation steps */
    int plot_int = -1;                                    /*!< plot interval (see ExaEpi::IO::writePlotFile) */
    int check_int = -1;                                   /*!< checkpoint interval (see ExaEpi::IO::writeCheckpointFile) */
    int random_travel_int = -1;                           /*!< steps between random travel events
                                                               (see AgentContainer::moveRandomTravel) */
    amrex::Real random_travel_prob = amrex::Real(0.0001); /*!< probability of an agent going on random travel */
    int air_travel_int = -1;
    short ic_type;                                        /*!< initialization type (see ExaEpi::ICType) */

    int num_diseases = 1;                                 /*!< Number of diseases to track */
    std::vector<std::string> disease_names;               /*!< Names of the diseases */

    /*! Census data filename (DemographicData::initFromFile)

        The file contents are:
        + The first line of the file contains the number of units.
        + The following lines have the following data:
          + ID (US-wide census tract ID)
          + Population
          + Number of day workers
          + FIPS code
          + Census tract number
          + Numbers of people in age groups: under 5, 5-17, 18-29, 30-64, and 65+
          + Number of households with: 1, 2, 3, 4, 5, 6, and 7 member(s)
    */
    std::string census_filename;
    std::string air_traffic_filename;
    std::string airports_filename;

    /*! UrbanPop data filename.
     */
    std::string urbanpop_filename;

    /*! Worker flow filename (ExaEpi::Initialization::readWorkerflow):
        It is a binary file that contains 3 x (number of work patthers) unsigned integer
        data. The 3 integers are: from, to, and the number of workers with this from and to.
        The from and to are the IDs from the first column of the census data file
        (#DemographicData::myID).
    */
    std::string workerflow_filename;

    int aggregated_diag_int = -1;       /*!< interval for writing aggregated diagnostic data
                                             (see: ExaEpi::IO::writeFIPSData) */
    std::string aggregated_diag_prefix; /*!< filename prefix for diagnostic data
                                             (see: ExaEpi::IO::writeFIPSData) */

    std::string restart_chkfile = "";   /*!< the name of the checkpoint to restart from */

    int shelter_start = -1;
    int shelter_length = 0;

    int nborhood_size = 500;
    int workgroup_size = 20;

    bool fast = false; /*!< Use the fast implementations for various operations, e.g. binning, at the cost of
                           exact reproducibility for a given random seed. */
};

/**
 * \brief enum for the different initial condition options.\n
 *        census reads in census data.\n
 */
struct ICType {
    enum {
        Census = 0,  /*!< Census data. Default */
        UrbanPop = 1 /*!< Data generated by UrbanPop */
    };
};

/*! \brief Namespace with utility functions */
namespace Utils {

void getTestParams(ExaEpi::TestParams& params, const std::string& prefix);
}
} // namespace ExaEpi

#endif
